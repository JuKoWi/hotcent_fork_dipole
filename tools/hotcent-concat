#!/usr/bin/env bash

usage() {
cat << EOF
usage: hotcent-concat [-d] [-h] [-q] [-t {sz,szp,dz,dzp}] symbols

Pastes the necessary *-*_offsite2c.skf and *-*_repulsion2c.skf files
together to form *-*.skf for all symbol pairs.

positional arguments:
  symbols               Element symbols (e.g. "Si").

options:
  -d                    Dry run (only print info and exit).
  -h                    Show this help message and exit.
  -q                    Do not print info to standard output.
  -t                    Basis set type (default: dzp).
EOF
}

dryrun=0
nzeta=1
verbose=1

while getopts "dhqt:" arg; do
  case $arg in
    d)
      dryrun=1
      ;;
    h)
      usage
      exit 0
      ;;
    q)
      verbose=0
      ;;
    t)
      case ${OPTARG} in
        sz|szp)
          nzeta=1
          ;;
        dz|dzp)
          nzeta=2
          ;;
        *)
          echo "Unknown basis set type '${OPTARG}'"
          exit 1
      esac
      ;;
    \?)
      usage
      exit 1
      ;;
  esac
done
shift $((OPTIND-1))

sets=""
for arg in "$@"; do
  for izeta in $(seq 1 ${nzeta}); do
    sets="${sets} ${arg}"
    arg="${arg}+"
  done
done

for a in ${sets}; do
  for b in ${sets}; do
    off2c="${a}-${b}_offsite2c.skf"
    rep2c="${a}-${b}_repulsion2c.spl"
    skf="${a}-${b}.skf"

    if [ ${verbose} = 1 ] && [ ${dryrun} = 1 ]; then
      echo -n "[Dry-run] "
    fi

    if [[ ${a: -1} != "+" && ${b: -1} != "+" ]]; then
      if [ ${verbose} = 1 ]; then
        echo "Pasting ${off2c} and ${rep2c} to ${skf}"
      fi

      if [ ${dryrun} = 0 ]; then
        cat ${off2c} ${rep2c} > ${skf}
      fi
    else
      if [ ${verbose} = 1 ]; then
        echo "Copying ${off2c} to ${skf}"
      fi

      if [ ${dryrun} = 0 ]; then
        cp ${off2c} ${skf}
      fi
    fi
  done
done
